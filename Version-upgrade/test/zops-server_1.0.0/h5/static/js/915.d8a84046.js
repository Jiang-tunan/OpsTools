/*!
 *  build: Vue  Admin Plus
 *  copyright: vue-admin-beautiful.com
 *  time: 2023-08-28 11:15:16
 */
"use strict";(self["webpackChunkadmin_plus"]=self["webpackChunkadmin_plus"]||[]).push([[915],{15489:function(e,t,a){a.d(t,{BK:function(){return l},D$:function(){return s},U$:function(){return u},hg:function(){return n},nc:function(){return o}});var i=a(52806);function n(e){return(0,i.Z)({params:{method:"mediatype.get",data:e}})}function o(e){return(0,i.Z)({params:{method:"mediatype.create",data:e}})}function s(e){return(0,i.Z)({params:{method:"mediatype.delete",data:e}})}function l(e){return(0,i.Z)({params:{method:"mediatype.update",data:e}})}function u(e){return(0,i.Z)({params:{method:"mediatype.sendmail",data:e}})}},79803:function(e,t,a){a.d(t,{Fh:function(){return o},ZC:function(){return l},cv:function(){return n},dW:function(){return c},i0:function(){return s},mY:function(){return u}});var i=a(52806);function n(e){return(0,i.Z)({params:{method:"problem.get",data:{selectAcknowledges:"extend",selectTags:"extend",selectSuppressionData:"extend",sortfield:"clock",sortorder:"DESC",...e}}})}function o(e){return(0,i.Z)({params:{method:"event.acknowledge",data:e}})}function s(e){return(0,i.Z)({params:{method:"action.create",data:e}})}function l(e){return(0,i.Z)({params:{method:"action.update",data:e}})}function u(e){return(0,i.Z)({params:{method:"action.get",data:e}})}function c(e){return(0,i.Z)({params:{method:"action.delete",data:e}})}},28671:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var i=a(21211),n=(a(24549),a(12791),a(46538)),o=(a(92719),a(20822),a(49530)),s=(a(80773),a(24434)),l=(a(98476),a(35568),a(6715),a(57847)),u=(a(43872),a(8734)),c=(a(7553),a(57658),a(66252)),d=a(2262),r=a(3577),p=a(49963),m=a(65781),f=a(79803),y=a(15489),v=a(22201);const g=e=>((0,c.dD)("data-v-0a34b47a"),e=e(),(0,c.Cn)(),e),h={class:"alarm-notify-detail"},k={class:"back-title"},_=g((()=>(0,c._)("span",{class:"title"},"告警通知组",-1))),b=g((()=>(0,c._)("span",{class:"divider"},"/",-1))),U={class:"back-name"},w={class:"alarm-notify-container"},D={class:"alarm-notify-content"},S={class:"title"},C={key:0,class:"notification-content"};var W={__name:"index",setup(e){const t=(0,c.RC)((()=>Promise.all([a.e(922),a.e(1108),a.e(6860),a.e(2584)]).then(a.bind(a,51006)))),g=(0,c.RC)((()=>Promise.all([a.e(922),a.e(1108),a.e(6860),a.e(9723)]).then(a.bind(a,92528)))),W=(0,c.RC)((()=>Promise.all([a.e(922),a.e(1108),a.e(6860),a.e(2964)]).then(a.bind(a,99184)))),q=(0,c.RC)((()=>Promise.all([a.e(922),a.e(1108),a.e(6860),a.e(9856)]).then(a.bind(a,99848)))),x=(0,v.tv)(),Z=(0,v.yj)(),R=(0,d.iH)({}),T=(0,d.iH)({}),V=(0,c.f3)("$baseMessage"),G=[{name:"设备",key:"0"},{name:"机房",key:"1"},{name:"数据中心",key:"2"}],j=[{key:"1001",name:"短信"},{key:"1002",name:"邮件"},{key:"1004",name:"企业微信"},{key:"1003",name:"钉钉"}],z={name:[{required:!0,message:"请输入通知组名称",trigger:"blur"}],devicedata:[{required:!0,message:"请选择设备",trigger:"change"}],notifications:[{required:!0,message:"请选择通知方式",trigger:"change"}]},H=(0,d.qj)({selectDeviceData:{data:{},visible:!1},selectRoomData:{data:{},visible:!1},notifyUserData:{data:{},visible:!1},notifyGroupData:{data:{},visible:!1},groupType:"",showText:"设备",dingtalData:[],wechatData:[]}),E=()=>{H.loading=!0;const e={},t=[],a=[];Z.query.actionid?(0,f.mY)({actionids:[Z.query.actionid],selectUpdateOperations:"extend",selectFilter:"extend",output:["name","choose_type","status","actionid"]}).then((i=>{if(!i.error&&i.length){const n=i[0];for(let a=0;a<j.length;a++){const i=j[a],o=n.update_operations.find((e=>e.opmessage.mediatypeid===i.key));if(o){const a=o.opmessage_usr.map((e=>e.userid)),n=o.opmessage_grp.map((e=>e.usrgrpid));o.userids=a,o.groupids=n,e[i.key]=o,t.push(o.opmessage.mediatypeid)}else e[i.key]={opmessage:{mediatypeid:i.key},opmessage_grp:[],opmessage_usr:[],userids:[],groupids:[],grpcount:0,usercount:0}}for(let e=0;e<n.filter.conditions.length;e++){const t=n.filter.conditions[e];a.push(t.value)}T.value={name:n.name,update_operations:n.update_operations||[],devicedata:a,notifications:t,choose_type:n.choose_type,filter:n.filter,clock:n.clock,actionid:n.actionid,status:n.status,notification:e},ee("dingding"),ee("wecom")}else V("该条数据不存在","error"),L();H.loading=!1})).catch((e=>{console.log("err :>> ",e),H.loading=!1})):K()};function K(){const e={};for(let t=0;t<j.length;t++){const a=j[t];e[a.key]={opmessage:{mediatypeid:a.key},opmessage_grp:[],opmessage_usr:[],userids:[],groupids:[],grpcount:0,usercount:0}}T.value={name:"",update_operations:[],devicedata:[],userdata:[],userids:[],choose_type:"0",filter:{},clock:"",actionid:"",status:"",notifications:[],notification:e},ee("dingding"),ee("wecom")}function P(){"0"===T.value.choose_type?H.selectDeviceData={data:{devicedata:T.value.devicedata||[]},visible:!0}:H.selectRoomData={title:"1"===`选择${T.value.choose_type}`?"机房":"数据中心",data:{deviceid:T.value.deviceid||[]},visible:!0}}function Y(){H.showText="0"===T.value.choose_type?"设备":"1"===T.value.choose_type?"机房":"数据中心",T.value.devicedata=[],T.value.filter.count=0}function $(){H.selectDeviceData.visible=!1}function A(e){T.value.devicedata=e,T.value.filter.count=e.length}function B(){H.selectRoomData.visible=!1}function F(e){T.value.devicedata=e,T.value.filter.count=e.length}function M(e){const t=T.value.notification[e];"1001"===e||"1002"===e?H.notifyUserData={data:{opmessage:t.opmessage,usercount:t.usercount,userids:t.userids},visible:!0}:(H.groupType="1004"===e?"wecom":"dingding",H.notifyGroupData={visible:!0,title:"1004"===e?"选择企业微信群":"选择钉钉群",data:{groupType:H.groupType,opmessage:{mediatypeid:e},usercount:t.usercount,groupids:t.groupids}})}function N(){H.notifyUserData.visible=!1}function I(e){const t=e.map((e=>e.userid)),a=H.notifyUserData.data.opmessage.mediatypeid;T.value.notification[a].userids=t,T.value.notification[a].usercount=t.length}function O(){H.notifyGroupData.visible=!1}function J(e){const t=e.map((e=>e.mediatypeid)),a=H.notifyGroupData.data.opmessage.mediatypeid;T.value.notification[a].groupids=t,T.value.notification[a].usercount=t.length}function L(){x.push({name:"AlarmSet",query:{tab:"AlarmNotify"}})}function Q(){R.value.validate((e=>{if(e){const e={name:T.value.name,status:"0",choose_type:T.value.choose_type,filter:{conditions:[]},update_operations:[],media_group:[]};T.value.notifications.map((t=>{const a=T.value.notification[t],i=a.opmessage.mediatypeid;if("1001"===i||"1002"===i){const t=[];a.userids.length&&(a.userids.map((e=>{t.push({userid:e})})),e.update_operations.push({opmessage_usr:t,opmessage:{mediatypeid:i}}))}else a.groupids.length&&a.groupids.map((t=>{e.media_group.push(t)}))}));for(let t=0;t<T.value.devicedata.length;t++){const a=T.value.devicedata[t],i="2"===T.value.choose_type?"30":"1"===T.value.choose_type?"29":"1";e.filter.conditions.push({conditiontype:i,operator:"0",value:a})}Z.query.actionid?(e.actionid=T.value.actionid,(0,f.ZC)(e).then((e=>{e.error||(V("编辑成功","success"),L())}))):(0,f.i0)(e).then((e=>{e.error||(V("创建成功","success"),L())}))}}))}function X(e,t){const a=[];if(T.value.update_operations.map((t=>{const i=e.find((e=>e.mediatypeid===t.opmessage.mediatypeid));i&&a.push(i.mediatypeid)})),"dingding"===t?H.dingtalData=e:H.wechatData=e,a.length){const e="dingding"===t?"1003":"1004";T.value.notifications.push(e),T.value.notification[e].groupids=a,T.value.notification[e].usercount=a.length}}function ee(e){(0,y.hg)({output:["group","mediatypeid","url","name","parameters"],search:{name:e}}).then((t=>{!t.error&&t.length&&X(t,e)}))}return(0,c.bv)((()=>{E()})),(e,a)=>{const f=u.gn,y=l.EZ,v=i.nH,x=s.rh,V=s.KD,E=o.ElButton,K=n.ElCheckbox,X=n.z5,ee=i.ly;return(0,c.wg)(),(0,c.iD)("div",h,[(0,c._)("div",k,[(0,c._)("span",{class:"back-btn",onClick:L},[(0,c.Wm)(f,null,{default:(0,c.w5)((()=>[(0,c.Wm)((0,d.SU)(m.Back))])),_:1}),_]),b,(0,c._)("span",U,(0,r.zw)((0,d.SU)(Z)?.query?.actionid?(0,d.SU)(T).name:"新增告警通知组"),1)]),(0,c._)("div",w,[(0,c._)("div",D,[(0,c._)("div",S,(0,r.zw)((0,d.SU)(Z)?.query?.actionid?"编辑":"新增")+"告警通知组 ",1),(0,c.Wm)(ee,{ref_key:"alarmNotiyFormRef",ref:R,model:(0,d.SU)(T),rules:z,class:"alarm-notify-form","label-width":"6.2rem",onConfirm:a[3]||(a[3]=(0,p.iM)((()=>{}),["prevent"]))},{default:(0,c.w5)((()=>[(0,c.Wm)(v,{label:"通知组名称",prop:"name"},{default:(0,c.w5)((()=>[(0,c.Wm)(y,{modelValue:(0,d.SU)(T).name,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,d.SU)(T).name=e),modelModifiers:{trim:!0},placeholder:"请输入通知组名称",maxlength:"100"},null,8,["modelValue"])])),_:1}),(0,c.Wm)(v,{label:"告警目标",prop:"choose_type"},{default:(0,c.w5)((()=>[(0,c.Wm)(V,{modelValue:(0,d.SU)(T).choose_type,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,d.SU)(T).choose_type=e),onChange:Y},{default:(0,c.w5)((()=>[((0,c.wg)(),(0,c.iD)(c.HY,null,(0,c.Ko)(G,(e=>(0,c.Wm)(x,{key:e.key,label:e.key},{default:(0,c.w5)((()=>[(0,c.Uk)((0,r.zw)(e.name),1)])),_:2},1032,["label"]))),64))])),_:1},8,["modelValue"])])),_:1}),(0,c.Wm)(v,{label:"选择设备",prop:"devicedata"},{default:(0,c.w5)((()=>[(0,c.Wm)(y,{disabled:"",placeholder:"已选择"+((0,d.SU)(T).filter?.count||0)+("设备"===(0,d.SU)(H).showText?"台设备":"个"+(0,d.SU)(H).showText)},null,8,["placeholder"]),(0,c.Wm)(E,{class:"form-btn",type:"primary",onClick:P},{default:(0,c.w5)((()=>[(0,c.Uk)(" 选择"+(0,r.zw)((0,d.SU)(H).showText),1)])),_:1})])),_:1}),(0,d.SU)(T).notification?((0,c.wg)(),(0,c.j4)(v,{key:0,label:"通知方式",prop:"notifications",class:"notification-form"},{default:(0,c.w5)((()=>[(0,c.Wm)(X,{modelValue:(0,d.SU)(T).notifications,"onUpdate:modelValue":a[2]||(a[2]=e=>(0,d.SU)(T).notifications=e),class:"notification-checkbox"},{default:(0,c.w5)((()=>[((0,c.wg)(),(0,c.iD)(c.HY,null,(0,c.Ko)(j,(e=>(0,c._)("div",{key:e.key},[(0,c.Wm)(K,{label:e.key},{default:(0,c.w5)((()=>[(0,c.Uk)((0,r.zw)(e.name),1)])),_:2},1032,["label"]),(0,d.SU)(T).notifications.includes(e.key)?((0,c.wg)(),(0,c.iD)("div",C,[(0,c.Wm)(y,{class:"notification-input",disabled:"",placeholder:"已选择"+((0,d.SU)(T).notification[e.key]?.usercount||0)+"个"+("1001"===e.key||"1002"===e.key?"用户":"群组")},null,8,["placeholder"]),(0,c.Wm)(E,{class:"notification-form-btn",type:"primary",plain:"",onClick:t=>M(e.key)},{default:(0,c.w5)((()=>[(0,c.Uk)(" 通知"+(0,r.zw)("1001"===e.key||"1002"===e.key?"用户":"群组"),1)])),_:2},1032,["onClick"])])):(0,c.kq)("",!0)]))),64))])),_:1},8,["modelValue"])])),_:1})):(0,c.kq)("",!0),(0,c.Wm)(v,null,{default:(0,c.w5)((()=>[(0,c.Wm)(E,{onClick:L},{default:(0,c.w5)((()=>[(0,c.Uk)("取消")])),_:1}),(0,c.Wm)(E,{type:"primary",onClick:Q},{default:(0,c.w5)((()=>[(0,c.Uk)("确定")])),_:1})])),_:1})])),_:1},8,["model"])])]),(0,d.SU)(H).selectDeviceData.visible?((0,c.wg)(),(0,c.j4)((0,d.SU)(g),{key:0,"select-device-data":(0,d.SU)(H).selectDeviceData.data,visible:(0,d.SU)(H).selectDeviceData.visible,onCancel:$,onConfirm:A},null,8,["select-device-data","visible"])):(0,c.kq)("",!0),(0,d.SU)(H).selectRoomData.visible?((0,c.wg)(),(0,c.j4)((0,d.SU)(t),{key:1,"checked-data":(0,d.SU)(H).selectRoomData.userids,visible:(0,d.SU)(H).selectRoomData.visible,type:(0,d.SU)(T).choose_type,title:(0,d.SU)(T).title,onCancel:B,onConfirm:F},null,8,["checked-data","visible","type","title"])):(0,c.kq)("",!0),(0,d.SU)(H).notifyUserData.visible?((0,c.wg)(),(0,c.j4)((0,d.SU)(W),{key:2,"notify-user-data":(0,d.SU)(H).notifyUserData.data,visible:(0,d.SU)(H).notifyUserData.visible,onCancel:N,onConfirm:I},null,8,["notify-user-data","visible"])):(0,c.kq)("",!0),(0,d.SU)(H).notifyGroupData.visible?((0,c.wg)(),(0,c.j4)((0,d.SU)(q),{key:3,"notify-user-data":(0,d.SU)(H).notifyGroupData.data,visible:(0,d.SU)(H).notifyGroupData.visible,title:(0,d.SU)(H).notifyGroupData.title,"table-data":"wecom"===(0,d.SU)(H).groupType?(0,d.SU)(H).wechatData:(0,d.SU)(H).dingtalData,onCancel:O,onConfirm:J},null,8,["notify-user-data","visible","title","table-data"])):(0,c.kq)("",!0)])}}};function q(e){e.__source="src/views/problem/alarm-setting/alarm-notify-detail/index.vue"}var x=a(83744);"function"===typeof q&&q(W);const Z=(0,x.Z)(W,[["__scopeId","data-v-0a34b47a"]]);var R=Z}}]);